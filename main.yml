---
  - name: Task for all
    hosts: all
    become: true
    tasks:
    - name: Update cache
      apt:
        update_cache: yes
        cache_valid_time: 6000
    - name: Install traceroute
      apt:
        name: traceroute
        state: present

  - name: Task for all routers
    hosts: routers
    become: true
    tasks:
    - name: Enable forwarding  
      sysctl:
        name: net.ipv4.ip_forward
        value: "1"
        state: present

  - name: Setup internet router
    hosts: inetrouter
    become: true
    roles:
      - role: web_access
      - role: change_gw_ir
      - role: knocking_ir

  - name: Setup internet router 2
    hosts: inetrouter2
    become: true
    roles:
      - role: port_forwarding
      - role: change_gw_ir2

  - name: Setup central router
    hosts: centralrouter
    become: true
    roles:
      - role: inst_nmap
      - role: nat_enable
      - role: change_gw_cr
      - role: knocking_cr

  - name: Setup central server
    hosts: servers
    become: true
    roles:
      - role: inst_nginx
      - role: change_gw_srv
