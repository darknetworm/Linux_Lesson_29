# Linux_Lesson_29
## Traffic filtering

### Описание репозитория

Лабораторный стенд для тестирования сетевой инфраструктуры с пробросом портов веб сервера в host-only сеть, использованием шлюза по умолчанию для доступа к сети интернет и использованием port knocking для доступа к шлюзу, настраиваемые с использованием Vagrant и Ansible. Все файлы и структуру директорий temрlates и roles необходимо скопировать в общую директорию.

![network](https://github.com/darknetworm/Linux_Lesson_29/assets/82410807/4a5d452c-01d0-4f28-874e-9c229ef3ac5c)


Схема сети лабораторного стенда

**Vagrantfile** - создает виртуальные машины: сервер с установленным nginx (centralserver), шлюз для выхода в интернет (inetrouter), шлюз доступа к веб-серверу с пробросом портов в host-only сеть (inetrouter2) и центральный маршрутизатор (centralrouter). Настройка функциональности хостов производится с помощью Ansible.  
**hosts** - файл с настройками компьютеров для быстрого доступа к ним из playbook.  
**main.yml** - основной файл Ansible playbook для установки и настройки сетевых устройств стенда (основные пункты конфигурирования сетевых устройств и используемые роли указаны в качестве комментариев).  
Директория **/templates** содержит файлы для конфигурирования port knocking технологии.  
Директория **/roles** содержит файлы конфигурирования сетевых устройств входящих в состав стенда, используемые в качестве ролей в основном файле Ansible main.yml.

---

### Проверка работоспособности стенда

Для проверки доступности сети интернет центрального сервера через inetrouter использовалась утилита traceroute:
![trace](https://github.com/darknetworm/Linux_Lesson_29/assets/82410807/6735fa70-a6f7-40a1-8505-5b394095061e)
Наблюдаем, что домен в интернете доступен через последовательность 192.168.0.1 - 192.168.255.1 - 10.0.2.2 (является шлюзом по умолчанию для inetrouter)

Для проверки port knocking необходимо подключиться по ssh к centralrouter и ввести команду:  

    ./knock.sh 192.168.255.1 9988 8877 7766
![knocking](https://github.com/darknetworm/Linux_Lesson_29/assets/82410807/29644c5e-7a58-45bf-b63d-505f996e868c)
С помощью утилиты nmap наблюдаем последовательное прохождение запросов по определенным портам на подключение по ssh к inetrouter.

Для проверки проброса портов до centralrouter с локальной машины в браузере вводим http запрос на host-only адрес inetrouter2 (192.168.56.10:8080)
![webpage](https://github.com/darknetworm/Linux_Lesson_29/assets/82410807/8a052898-82c3-4bd3-9f2e-e258f8eea0b9)
